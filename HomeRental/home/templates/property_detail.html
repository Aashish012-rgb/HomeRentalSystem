{% extends "layout.html" %}

{% block title %}{{ property.title }}{% endblock %}

{% block extra_head %}
{% if is_compact_view %}
<style>
    .property-detail-wrap {
        max-width: 560px;
        margin: 0 auto;
    }

    .property-detail-image {
        max-height: 200px;
        object-fit: cover;
    }
</style>
{% endif %}
{% endblock %}

{% block content %}
<section class="container py-4 py-lg-5">
    <article class="card shadow-sm property-detail-wrap">
        {% if property.image %}
        <img src="{{ property.image.url }}" class="card-img-top property-detail-image" alt="{{ property.title }}">
        {% endif %}
        <div class="card-body">
            <h1 class="h3">{{ property.title }}</h1>
            <p class="mb-1"><strong>Location:</strong> {{ property.location }}</p>
            <p class="mb-1"><strong>Type:</strong> {{ property.property_type|title }}</p>
            <p class="mb-3"><strong>Price:</strong> {{ property.price }}</p>
            {% if property.contact_name or property.contact_phone or property.contact_email %}
            <div class="mb-3">
                <p class="mb-1"><strong>Contact Details</strong></p>
                {% if property.contact_name %}<p class="mb-1"><strong>Name:</strong> {{ property.contact_name }}</p>{% endif %}
                {% if property.contact_phone %}<p class="mb-1"><strong>Phone:</strong> {{ property.contact_phone }}</p>{% endif %}
                {% if property.contact_email %}<p class="mb-1"><strong>Email:</strong> {{ property.contact_email }}</p>{% endif %}
            </div>
            {% endif %}
            <p class="mb-4">{{ property.description }}</p>

            <div class="d-flex flex-wrap gap-2">
                {% if request.user.is_authenticated and request.user != property.user %}
                <form method="post" action="{% url 'book_property' property.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">Book Now</button>
                </form>
                {% elif not request.user.is_authenticated %}
                <a href="{% url 'login' %}?next={% url 'property_detail' property.id %}" class="btn btn-primary">Login to Book</a>
                {% endif %}
                <a href="{% url 'properties' %}" class="btn btn-outline-secondary">Back to Properties</a>
            </div>
        </div>
    </article>
</section>
{% endblock %}
